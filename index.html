<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PHÚ VINH OS | CLOUD SYSTEM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; }
        body { font-family: 'Inter', sans-serif; background-color: #050505; color: #fef3c7; overflow-x: hidden; }
        .chinese-title { font-family: 'Noto Serif SC', serif; }
        .input-pro { background-color: #ffffff !important; color: #000000 !important; font-weight: 900 !important; height: 50px; padding: 0 15px; border-radius: 8px; width: 100%; border: none; outline: none; }
        .luxury-panel { background: linear-gradient(145deg, rgba(153, 27, 27, 0.05), rgba(0, 0, 0, 0.6)); border: 1px solid rgba(212, 175, 55, 0.2); border-left: 5px solid var(--gold); backdrop-filter: blur(10px); }
        .gold-text { background: linear-gradient(180deg, #fde68a 0%, #d4af37 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav-capsule { background: rgba(10, 10, 10, 0.95); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 999px; padding: 6px; }
        .nav-active { background-color: var(--gold); color: #000; box-shadow: 0 0 25px rgba(212, 175, 55, 0.8); transform: scale(1.05); }
        .fade-up { animation: fadeUp 0.5s ease-out; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- CẤU HÌNH FIREBASE CỦA BẠN ---
        const firebaseConfig = {
          apiKey: "AIzaSyDQmerSSs0qhO01xNnFWpquZYseDThWxP0",
          authDomain: "lichtruc-e3f82.firebaseapp.com",
          projectId: "lichtruc-e3f82",
          storageBucket: "lichtruc-e3f82.firebasestorage.app",
          messagingSenderId: "476557236437",
          appId: "1:476557236437:web:dfb1cb5848642daecdaa5c",
          measurementId: "G-QYQCZCLWR4"
        };

        // Khởi tạo Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // --- APP CHÍNH ---
        const App = () => {
            const [view, setView] = useState('menu');
            const [customers, setCustomers] = useState([]);
            const [orders, setOrders] = useState([]);
            const [loading, setLoading] = useState(true);
            const [customerForm, setCustomerForm] = useState({ id: null, name: '', phone: '', note: '' });

            // Đọc dữ liệu từ Firebase khi mở App
            useEffect(() => {
                const unsubCustomers = db.collection("customers").onSnapshot(snap => {
                    setCustomers(snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                });
                const unsubOrders = db.collection("orders").orderBy("timestamp", "desc").onSnapshot(snap => {
                    setOrders(snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    setLoading(false);
                });
                return () => { unsubCustomers(); unsubOrders(); };
            }, []);

            // --- CÁC HÀM XỬ LÝ DỮ LIỆU ---
            const handleSaveCustomer = async () => {
                if (!customerForm.name || !customerForm.phone) return alert("THIẾU THÔNG TIN!");
                const data = { ...customerForm, name: customerForm.name.toUpperCase() };
                if (customerForm.id) {
                    await db.collection("customers").doc(customerForm.id).update(data);
                } else {
                    delete data.id;
                    await db.collection("customers").add(data);
                }
                setCustomerForm({ id: null, name: '', phone: '', note: '' });
                alert("Đã lưu khách hàng!");
            };

            const handleAddOrder = async (orderData) => {
                await db.collection("orders").add({
                    ...orderData,
                    timestamp: new Date().toISOString(),
                    isCompleted: false
                });
                alert("Đã tạo đơn hàng!");
            };

            const handleConfirmOrder = async (id, returnBins, collectedCash) => {
                const order = orders.find(o => o.id === id);
                await db.collection("orders").doc(id).update({
                    isCompleted: true,
                    returnBins: parseInt(returnBins),
                    debtBins: order.qtyBinh - parseInt(returnBins),
                    collectedCash: parseInt(collectedCash),
                    debtCash: order.totalAmount - parseInt(collectedCash)
                });
            };

            if (loading) return <div className="h-screen flex items-center justify-center gold-text chinese-title text-4xl animate-pulse">ĐANG KẾT NỐI...</div>;

            // Render giao diện (Giữ nguyên toàn bộ các Module như đã thống nhất)
            // ... (Tiếp tục phần render view đã viết ở các phiên bản trước) ...
            
            return (
                <div className="min-h-screen pb-48">
                    {/* Dựa trên biến view, hiển thị Module tương ứng và truyền các hàm Firebase vào */}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
