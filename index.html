<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giviso Water - H·ªá Th·ªëng Qu·∫£n Tr·ªã H·ª£p Nh·∫•t</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIza...", // D√°n m√£ c·ªßa b·∫°n v√†o ƒë√¢y
            projectId: "your-project-id",
            // ... c√°c th√¥ng s·ªë kh√°c
        };

        const app = initializeApp(firebaseConfig);
        window.db = getFirestore(app);
        window.fs = { collection, onSnapshot, query, orderBy };
    </script>

    <style>
        .dashboard-card { @apply bg-white rounded-xl shadow-sm border border-slate-200 p-4 overflow-hidden flex flex-col; }
        .section-title { @apply text-sm font-bold text-slate-500 uppercase tracking-wider mb-3 flex items-center gap-2; }
    </style>
</head>
<body class="bg-slate-100 h-screen overflow-hidden p-2">
    <div id="root" class="h-full"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [data, setData] = useState([]);

            useEffect(() => {
                const { collection, onSnapshot, query, orderBy } = window.fs;
                const q = query(collection(window.db, "deliveries"), orderBy("timestamp", "desc"));
                const unsub = onSnapshot(q, (sn) => setData(sn.docs.map(d => ({id: d.id, ...d.data()}))));
                return () => unsub();
            }, []);

            return (
                <div className="grid grid-cols-2 grid-rows-2 gap-2 h-full">
                    
                    {/* 1. QU·∫¢N L√ù CHUNG (B√ÅO C√ÅO) */}
                    <div className="dashboard-card border-l-4 border-l-blue-500">
                        <h2 className="section-title">üìä T·ªïng h·ª£p - B√°o c√°o</h2>
                        <div className="grid grid-cols-2 gap-2 mb-4">
                            <div className="bg-blue-50 p-3 rounded-lg text-center">
                                <p className="text-[10px] text-blue-600 font-bold uppercase">S·∫£n l∆∞·ª£ng</p>
                                <p className="text-2xl font-black text-blue-800">{data.reduce((sum, item) => sum + (Number(item.quantity) || 0), 0)}</p>
                            </div>
                            <div className="bg-green-50 p-3 rounded-lg text-center">
                                <p className="text-[10px] text-green-600 font-bold uppercase">V·ªè ƒë√£ thu</p>
                                <p className="text-2xl font-black text-green-800">{data.reduce((sum, item) => sum + (Number(item.emptyShellsReturned) || 0), 0)}</p>
                            </div>
                        </div>
                        <div className="text-xs text-slate-400 italic mt-auto italic">D·ªØ li·ªáu c·∫≠p nh·∫≠t th·ªùi gian th·ª±c t·ª´ h·ªá th·ªëng.</div>
                    </div>

                    {/* 2. QU·∫¢N L√ù KH√ÅCH H√ÄNG */}
                    <div className="dashboard-card border-l-4 border-l-purple-500">
                        <h2 className="section-title">üë• Qu·∫£n l√Ω kh√°ch h√†ng</h2>
                        <div className="overflow-y-auto space-y-2">
                            {[...new Set(data.map(d => d.customerName))].map(name => (
                                <div key={name} className="flex justify-between items-center p-2 bg-slate-50 rounded border border-slate-100 text-sm">
                                    <span className="font-medium text-slate-700">{name}</span>
                                    <span className="text-[10px] bg-purple-100 text-purple-600 px-2 py-0.5 rounded font-bold uppercase">Th√¢n thi·∫øt</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* 3. QU·∫¢N L√ù ƒê∆†N H√ÄNG (SHIPPING) */}
                    <div className="dashboard-card border-l-4 border-l-amber-500">
                        <h2 className="section-title">üöö Qu·∫£n l√Ω ƒë∆°n h√†ng</h2>
                        <div className="overflow-y-auto space-y-2">
                            {data.map(order => (
                                <div key={order.id} className="p-2 border rounded-lg text-xs flex justify-between items-center bg-white shadow-sm">
                                    <div>
                                        <p className="font-bold text-slate-800">{order.customerName}</p>
                                        <p className="text-slate-400 italic truncate w-32">{order.address}</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="font-black text-amber-600">{order.quantity}B</p>
                                        <p className={`text-[9px] font-bold ${order.status === 'completed' ? 'text-green-500' : 'text-amber-400'}`}>
                                            {order.status === 'completed' ? 'DONE' : 'DELIVERING'}
                                        </p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* 4. QU·∫¢N L√ù KHO */}
                    <div className="dashboard-card border-l-4 border-l-cyan-500">
                        <h2 className="section-title">üì¶ Qu·∫£n l√Ω kho</h2>
                        <div className="flex-1 flex flex-col justify-center items-center">
                            <div className="relative w-24 h-24 flex items-center justify-center border-4 border-cyan-100 rounded-full">
                                <div className="text-center font-black text-cyan-600">
                                    <p className="text-xl leading-none">500</p>
                                    <p className="text-[8px] uppercase">T·ªìn kho</p>
                                </div>
                            </div>
                            <div className="mt-4 grid grid-cols-2 gap-4 w-full text-center">
                                <div><p className="text-xs text-slate-400 font-bold">NH·∫¨P</p><p className="font-bold text-slate-700">+1200</p></div>
                                <div><p className="text-xs text-slate-400 font-bold">XU·∫§T</p><p className="font-bold text-slate-700">-700</p></div>
                            </div>
                        </div>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
